#!/usr/bin/perl

$SIG{ 'CHLD' } = 'IGNORE';
$| = 1;
$0 = "jolicloud-launcher";

my $URL = "http://launcher.dev.jolicloud.org";

my $pid = 0;
open( STDOUT, ">>/tmp/jolicloud-launcher.log" );

if ( $pid = fork ) {
    open( STDERR, ">>/tmp/jolicloud-daemon.log" );
    for ( ;; ) {
        print "jolicloud-daemon: launching...\n";
        system( "/usr/bin/jolicloud-daemon", "-d" );
        if ( $? == -1 ) {
            print "jolicloud-daemon: failed to execute: $!\n";
        }
        else {
            print "jolicloud-daemon: child exited with value %d\n",
                  $? >> 8;
        }
    }
    exit;
}
if ( $pid = fork ) {
    open( STDERR, ">>/tmp/jolicloud-daemon.log" );
    for ( ;; ) {
        print "nickel-browser: launching...\n";
        system( "/usr/bin/nickel-browser", "--app=$URL", "--desktop",
                "--no-default-browser-check", "--enable-logging=stderr",
                "--log-level=0" );
        if ( $? == -1 ) {
            print "nickel-browser: failed to execute: $!\n";
        }
        else {
            print "nickel-browser: child exited with value %d\n", 
                  $? >> 8;
        }
    }
    exit;
}


