#!/bin/bash
# postinst script for jolicloud-launcher
#
# see: dh_installdeb(1)

set -e

# dh_installdeb will replace this with shell code automatically
# generated by other debhelper scripts.

case "$1" in
    configure)
        if dpkg --compare-versions "$2" le "1.0.0"; then
            echo "Forcing reboot to switch to new launcher."
            touch /var/run/reboot-required

            # FIXME: Enhance jolicloud-notifier's reboot-dialog so it
            # automatically uses apt-queue and watches for
            # /var/run/reboot-required itself.
            apt-queue /usr/lib/jolicloud-notifier/reboot-dialog
        fi

        if dpkg --compare-versions "$2" le "2.0.0"; then
            echo "Removing autostart jolicloud-launcher.desktop"
            if [ -e /etc/xdg/autostart/jolicloud-launcher.desktop ]; then
                rm /etc/xdg/autostart/jolicloud-launcher.desktop;
            fi
        fi
esac

#DEBHELPER#

exit 0
